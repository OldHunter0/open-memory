version: '3.8'
services:
  weaviate:
    container_name: weaviate
    image: semitechnologies/weaviate
    environment:
      ENABLE_MODULES: "text2vec-ollama"
      OLLAMA_API_ENDPOINT: "http://ollama:11434"  # ä½¿ç”¨æœåŠ¡åé€šä¿¡
    networks:
      - braindance_net  # è‡ªå®šä¹‰ç½‘ç»œ
    ports:
      - "8080:8080"
      - "50051:50051"

  ollama:  # ç¡®ä¿æœåŠ¡åä¸é…ç½®ä¸€è‡´
    container_name: ollama
    image: ollama/ollama:latest
    networks:
      - braindance_net
    ports:
      - "11434:11434"  # åªæ˜ å°„å¿…è¦ç«¯å£
    volumes:
      - ollama_data:/root/.ollama  # æŒä¹…åŒ–æ¨¡å‹æ•°æ®
    entrypoint:
      - /bin/sh
      - -c
      - |
        /bin/ollama serve
        pid=$!
        sleep 5
        echo "ğŸ”´ Retrieve mxbai-embed-large model..."
        ollama pull mxbai-embed-large
        echo "ğŸŸ¢ Done!"
        wait $pid

networks:
  braindance_net:  # å®šä¹‰ç»Ÿä¸€ç½‘ç»œ
    driver: bridge

volumes:
  ollama_data:  # æŒä¹…åŒ–å­˜å‚¨